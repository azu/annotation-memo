#!/bin/bash

declare parentDir=$(cd $(dirname $(cd $(dirname $0);pwd));pwd)
# pull from repository
git subtree pull --prefix=lib https://github.com/azu/pdf-markdown-annotator.git master --squash
git subtree pull --prefix=pdfjs https://github.com/mozilla/pdf.js.git master --squash
rm ${parentDir}/lib/.gitmodules
rm -rf ${parentDir}/lib/pdfjs
rm ${parentDir}/pdfjs/.gitmodules
rm -rf ${parentDir}/pdfjs/test/ttx/fonttools-code
# build js/css
cd ${parentDir}/lib
npm install && npm run build
mkdir -p ../resources
cp -f dist/build.js ../resources
cp -f css/index.css ../resources
cp -f css/index.css.map ../resources
cp -f node_modules/codemirror/lib/codemirror.css ../resources
cp -f -r node_modules/font-awesome/ ../resources/font-awesome
cd -
